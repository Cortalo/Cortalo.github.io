<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Analog Circuits" /><meta property="og:locale" content="en" /><meta name="description" content="Papers" /><meta property="og:description" content="Papers" /><link rel="canonical" href="/posts/analog-circuits/" /><meta property="og:url" content="/posts/analog-circuits/" /><meta property="og:site_name" content="Looooooong" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-30T05:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Analog Circuits" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-08-06T21:48:15+00:00","datePublished":"2023-07-30T05:00:00+00:00","description":"Papers","headline":"Analog Circuits","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/analog-circuits/"},"url":"/posts/analog-circuits/"}</script><title>Analog Circuits | Looooooong</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Looooooong"><meta name="application-name" content="Looooooong"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> </a></div><div class="site-title mt-3"> <a href="/">Looooooong</a></div><div class="site-subtitle font-italic">Don't confuse them, if you cannot convince them.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/github_username" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['helong_ms','outlook.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Analog Circuits</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Analog Circuits</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1690693200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 30, 2023 </em> </span> <span> Updated <em class="" data-ts="1722980895" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 6, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Long</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1587 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h1 id="papers">Papers</h1><p><a href="https://ieeexplore.ieee.org/document/50316">A high-swing, high-impedance MOS cascode circuit</a></p><ul><li>regulated cascode (or RGC) achieves higher output impedance than simple cascode.<li>RGC has larger output voltage range than optimally biased simple cascode.</ul><p><a href="https://ieeexplore.ieee.org/document/295247">The active-input regulated-cascode current mirror</a></p><p><a href="https://ieeexplore.ieee.org/document/1356659">Ultra high-compliance CMOS current mirrors for low voltage charge pumps and references</a></p><p><a href="https://ieeexplore.ieee.org/document/1050527">Relationship between frequency response and settling time of operational amplifiers</a></p><p><a href="https://ieeexplore.ieee.org/document/5607216">An Integrated Linear Regulator With Fast Output Voltage Transition for Dual-Supply SRAMs in DVFS Systems</a></p><p>From <a href="https://link.springer.com/book/10.1007/b135984">Analog Design Essentials</a></p><h1 id="amplifiers-source-followers-and-cascodes">Amplifiers, source followers and cascodes</h1><p><strong>024: Single-transistor amplifier</strong></p>\[A_v = g_m r_{DS} = \dfrac{2 I_{DS}}{V_{ov}} \cdot \dfrac{V_E L}{I_{DS}} = \dfrac{2 V_E L}{V_{ov}}\]<ul><li>high gain needs large \(L\) and high \(g_m/i_d\)</ul><p><strong>0213: Miller capacitance feedback effects</strong></p><ul><li>the \(C_{gd}\) miller capacitor gives a positive zero:<ul><li>the gain magnitude becomes constant at high frequency, since the transistor is diode connected with impedance \(1/g_m\)<li>the phase becomes in-phase at high frequency instead of completely-out-of-phase at low frequency<li>such a phenomenon can only be explained by a positve zero after the negative pole<li>full small-signal analysis reveals that \(f_z = \dfrac{g_m}{2\pi C_F}\)</ul></ul><p><strong>0250: Cascode with resistive load</strong></p><ul><li>cascode convert current to voltage, the gain will be larger if the load resistance is larger.<li>however, in reality the gain cannot increase to infinity, to see the limit we have to include the \(R_B\) and \(r_{DS}\).</ul><h1 id="stability-of-operational-amplifiers">Stability of Operational amplifiers</h1><p><strong>0515: What makes an opamp an opamp?</strong></p><p>An opamp is really a single-pole system. As a result, it allows exchange of gain with bandwidth, within a specific GBW.</p><p>Usually the number number of high impedance nodes indicates the number of poles, there can be only one internal node at high impedance for opamp.</p><p>All two-stage amplifiers have two high-impedance nodes and hence two poles. Therefore, all amplifiers with two high-impedance nodes are called two-stage amplifiers, irrespective of the number of transistors.</p><p>Wideband amplifiers are very different. They consist of more stages, each of them having a pole. They are normally compensated at one particular setting of the gain. They are not meant to exchange gain for bandwidth.</p><p><strong>0526: Relation PM, damping and \(f_2/\text{GBW}\)</strong></p><div class="table-wrapper"><table><thead><tr><th>\(\dfrac{f_2}{\text{GBW}}\)<th>PM (\(^\circ\))<th>\(\zeta = \dfrac{1}{2}\sqrt{\dfrac{f_2}{GBW}}\)<th>\(P_f\) (dB)<th>\(P_t\) (dB)<tbody><tr><td>0.5<td>27<td>0.35<td>3.6<td>2.3<tr><td>1<td>45<td>0.5<td>1.25<td>1.3<tr><td>1.5<td>56<td>0.61<td>0.28<td>0.73<tr><td>2<td>63<td>0.71<td>0<td>0.37<tr><td>3<td>72<td>0.87<td>0<td>0.04</table></div><p>When designing opamp we will try to avoid peaking. Thus \(72^\circ\) PM is a good safety position to start with, as all parasitic capacitances come in after layout, pushing the non-domiant pole to lower values and decreasing the phase margin. Eventually \(63^\circ\) PM is good enough to not have peaking in the frequency domain.</p><p>Another reason for \(63^\circ \sim 72^\circ\) PM is that it is a good compromise between peaking and bandwidth; Larger PM reduces the bandwidth too much.</p><p><strong>0530: Generic 2-stage opamp</strong></p><p><img data-src="/assets/img/2023-07-30-analog-circuits/screenshot_002.png" style="width:40%;height:40%;" data-proofer-ignore></p><p>  \(GBW = \dfrac{g_{m1}}{2\pi C_c}\), since node 1 is virtual ground, and the output voltage is generated by the current flow through \(C_c\).</p><p>  \(f_{nd} = \dfrac{g_{m2}}{2\pi C_L}\), since at high frequency \(C_c\) is shorted, the non-domiant pole is calculated by the impedance at node 1.</p><p>  \(f_z = \dfrac{g_{m2}}{2\pi C_c}\), this is a positive zero.</p><h1 id="systematic-design-of-operational-amplifiers">Systematic Design of Operational Amplifiers</h1><h1 id="basics">Basics</h1><p><a href="https://www.bilibili.com/video/BV1UV4y1k791/">Prof. Jri Lee’s Lecture</a></p><h2 id="differential-pair"><span class="mr-2">Differential Pair</span><a href="#differential-pair" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>\[A_v = - g_m R_D\]<h3 id="cmrr"><span class="mr-2">CMRR</span><a href="#cmrr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>\[CMRR = \dfrac{\vert A_{DM} \vert}{\vert A_{CM-DM} \vert}\] \[\vert A_{CM-DM}\vert_1 = \left\vert \dfrac{\Delta R_c}{1/g_m + 2 R_{EE}} \right\vert\] \[\vert A_{CM-DM}\vert_1 = \left\vert \dfrac{\Delta g_m R_c}{1+2g_mR_{EE}} \right\vert\] \[\vert A_{CM-DM} \vert = \sqrt{\vert A_{CM-DM} \vert_1^2 + \vert A_{CM-DM}\vert_2^2}\]<h3 id="offset"><span class="mr-2">Offset</span><a href="#offset" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>\[V_{os,1} = \dfrac{(V_{GS}-V_{TH})\Delta R_D}{2 R_D}\] \[V_{os,2} = \dfrac{(V_{GS}-V_{TH})\Delta\left(\dfrac{W}{L}\right)}{2\left(\dfrac{W}{L}\right)}\] \[V_{os,3} = \Delta V_{TH}\] \[V_{os} = \sqrt{V_{os,1}^2+V_{os,2}^2+V_{os,3}^2}\]<h3 id="current-mirror-load"><span class="mr-2">Current Mirror Load</span><a href="#current-mirror-load" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>\[A_v = g_m (r_{on}\Vert r_{op})\]<h2 id="frequency-response-lecture-6"><span class="mr-2">Frequency Response (Lecture 6)</span><a href="#frequency-response-lecture-6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>\[H(s) = A_v \cdot \dfrac{(1+s/\omega_{z,1})\dots (1_s/\omega_{z,n})}{(1+s/\omega_{p,1}) \dots (1+s/\omega_{p,n})}\]<h3 id="coupling-capacitor-and-bypass-capacitor"><span class="mr-2">Coupling Capacitor and Bypass Capacitor</span><a href="#coupling-capacitor-and-bypass-capacitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The approximated method:</p><ul><li>Each capacitor generates (exactly) one pole and one zero.<li>The zero may degenerate to zero or infinite frequency.<li>The pole frequency is found by RC time constant.<li>The zero frequency is found by finding the frequency when the output is zero (when all the other capacitors are working ideally small or large).</ul><h3 id="miller-effect"><span class="mr-2">Miller Effect</span><a href="#miller-effect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>LHP zero is okay. RHP zero is dangerous.</p><h3 id="open-circuit-time-constant-lecture-8"><span class="mr-2">Open Circuit Time Constant (Lecture 8)</span><a href="#open-circuit-time-constant-lecture-8" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="common-source"><span class="mr-2">Common Source</span><a href="#common-source" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="common-gate-lecture-9"><span class="mr-2">Common Gate (Lecture 9)</span><a href="#common-gate-lecture-9" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="common-drain-lecture-10"><span class="mr-2">Common Drain (Lecture 10)</span><a href="#common-drain-lecture-10" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="differential-pair-1"><span class="mr-2">Differential Pair</span><a href="#differential-pair-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h2 id="feedback-lecture-13"><span class="mr-2">Feedback (Lecture 13)</span><a href="#feedback-lecture-13" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h2 id="operational-amplifier"><span class="mr-2">Operational Amplifier</span><a href="#operational-amplifier" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="two-stage-amplifier"><span class="mr-2">Two Stage Amplifier</span><a href="#two-stage-amplifier" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="slew-rate"><span class="mr-2">Slew Rate</span><a href="#slew-rate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="psrr"><span class="mr-2">PSRR</span><a href="#psrr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="folded-opamp"><span class="mr-2">Folded Opamp</span><a href="#folded-opamp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="limiter"><span class="mr-2">Limiter</span><a href="#limiter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="cmfb"><span class="mr-2">CMFB</span><a href="#cmfb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/2023-07-30-analog-circuits/screenshot_001.png" style="width:70%;height:70%;" data-proofer-ignore></p><p>One of the CMFB is using triode devices. The M7 and M8 will be in deep triode region, such that the current sources M5 and M6 are degenarated. Assume the current sources M5 and M6 are bigger than M9 and M10, then the output common mode will be lower than nomimal output CM level. The gate voltage of M7 and M8 will decrease, and their resistance will increase, the current of M5 and M6 will decrease.</p><p><img data-src="/assets/img/2023-07-30-analog-circuits/007.png" style="width:100%;height:100%;" data-proofer-ignore></p><p>Another way of CMFB is using a differential pair to generate a current.</p><h2 id="digital-circuits"><span class="mr-2">Digital Circuits</span><a href="#digital-circuits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="sr-latch"><span class="mr-2">SR Latch</span><a href="#sr-latch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="d-flip-flop"><span class="mr-2">D-Flip Flop</span><a href="#d-flip-flop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="c2mos-latch"><span class="mr-2">C2MOS Latch</span><a href="#c2mos-latch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="cml-latch"><span class="mr-2">CML Latch</span><a href="#cml-latch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h1 id="impedance-formula">Impedance Formula</h1>\[R \Vert \dfrac{1}{sC} = \dfrac{R}{1+sRC}\]<h1 id="impedance-transformation">Impedance Transformation</h1><h2 id="series-to-parallel"><span class="mr-2">Series-to-Parallel</span><a href="#series-to-parallel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="inductor"><span class="mr-2">Inductor</span><a href="#inductor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>\[Q = \dfrac{\omega L_s}{R_s}\] \[R_p = R_s(1+Q^2)\] \[L_p = L_s (1+\dfrac{1}{Q^2})\]<h3 id="capacitor"><span class="mr-2">Capacitor</span><a href="#capacitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>\[Q = \dfrac{1}{\omega R_s C_s}\] \[R_p = R_s(1+Q^2)\] \[C_p = \dfrac{C_s}{1+\dfrac{1}{Q^2}}\]<h2 id="parallel-to-series"><span class="mr-2">Parallel-to-Series</span><a href="#parallel-to-series" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="inductor-1"><span class="mr-2">Inductor</span><a href="#inductor-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>\[Q = \dfrac{R_p}{\omega L_p}\] \[R_s = \dfrac{R_p}{1+Q^2}\] \[L_s = \dfrac{L_p}{1+\dfrac{1}{Q^2}}\]<h3 id="capacitor-1"><span class="mr-2">Capacitor</span><a href="#capacitor-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>\[Q = \omega R_p C_p\] \[R_s = \dfrac{R_p}{1+Q^2}\] \[C_s = C_p (1+\dfrac{1}{Q^2})\]<h2 id="high-q-system"><span class="mr-2">High-Q System</span><a href="#high-q-system" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For inductor</p>\[Q = \dfrac{\omega L_s}{R_s} = \dfrac{R_p}{\omega L_p}\]<p>if \(Q\) is large, \(L_s \approx L_p\) (with error \(1 + \dfrac{1}{Q^2}\))</p>\[R_s R_p = (\omega L)^2\]<p>For capacitor</p>\[Q = \dfrac{1}{\omega R_s C_s} = \omega R_p C_p\]<p>if \(Q\) is large, \(C_s \approx C_p\) (with error \(1 + \dfrac{1}{Q^2}\))</p>\[R_s R_p = \dfrac{1}{(\omega C)^2}\]<h1 id="oscillator">Oscillator</h1><p>From <a href="https://space.bilibili.com/1629031600">Prof. Jri Lee’s Lectures</a></p><h2 id="barkhausen-criteria"><span class="mr-2">Barkhausen Criteria</span><a href="#barkhausen-criteria" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When the oscillator just starts to oscillate, we can use small signal model. If the closed-loop transfer function is</p>\[H(s) = \dfrac{A(s)}{1+A(s)\beta(s)}\]<p>It must be unstable at the equilibrium point, thus from the concept of gain margin</p>\[\begin{align} \angle A(j\omega_{\text{x}})\beta(j\omega_{\text{x}}) &amp;= -180^\circ\\ \vert A(j\omega_{\text{x}})\beta(j\omega_{\text{x}}))\vert &amp;&gt; 1 \end{align}\]<h2 id="wien-bridge-oscillator"><span class="mr-2">Wien-Bridge Oscillator</span><a href="#wien-bridge-oscillator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/2023-07-30-analog-circuits/001.png" style="width:50%;height:50%;" data-proofer-ignore></p><p>we assume the input is at</p><p><img data-src="/assets/img/2023-07-30-analog-circuits/002.png" style="width:50%;height:50%;" data-proofer-ignore></p><p>let</p>\[\begin{align} Z_p &amp;= \dfrac{R}{1+sRC}\\ Z_s &amp;= R + \dfrac{1}{sC} \end{align}\]<p>the closed-loop transfer function can be calculated as</p>\[H(s) = \dfrac{V_{out}(s)}{V_{in}(s)} = \dfrac{(R_1 + R_2)/R_1}{1 - \dfrac{R_2}{R_1} \dfrac{Z_p}{Z_s}}\] \[\dfrac{R_2}{R_1} \dfrac{Z_p}{Z_s} = \dfrac{R_2}{R_1} \dfrac{j\omega RC}{1-\omega^2 R^2C^2 + 2j\omega RC}\] \[\omega_x = \dfrac{1}{RC}\] \[\dfrac{R_2}{2R_1} &gt; 1\]<h2 id="colpitts-oscillator"><span class="mr-2">Colpitts Oscillator</span><a href="#colpitts-oscillator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/2023-07-30-analog-circuits/003.png" style="width:50%;height:50%;" data-proofer-ignore></p><p><img data-src="/assets/img/2023-07-30-analog-circuits/006.png" style="width:70%;height:70%;" data-proofer-ignore></p><h2 id="self-charged-xo"><span class="mr-2">Self-Charged XO</span><a href="#self-charged-xo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://ieeexplore.ieee.org/document/7370766">ISSCC 2012, JSSC 2016</a></p><ul><li>The sine wave will first be converted to square wave, with the requirement that the output will trip exactly in the middle of the input voltage swing. A self-adaptive boby-biasing technique is used.</ul><p><a href="https://ieeexplore.ieee.org/document/6757442">ISSCC 2014</a></p><p><a href="https://ietresearch.onlinelibrary.wiley.com/doi/10.1049/el.2015.1703">Electronics Letters 2016</a></p><p><a href="https://ieeexplore.ieee.org/document/8240214">ASSCC 2017</a></p><p><a href="https://ieeexplore.ieee.org/document/8816671">JSSC 2019</a></p><p><a href="https://ieeexplore.ieee.org/document/9196439">VLSI-DAT 2020</a></p><p><a href="https://ieeexplore.ieee.org/document/9477613">JSSC 2022</a></p><h1 id="flicker-noise">Flicker Noise</h1>\[A \cdot \dfrac{f_c}{f}\] \[1.38 A \cdot \dfrac{f_c}{f_{min}} \sum_{n=0}^{N_{max}} \dfrac{10^{-n}}{1+(\dfrac{f}{10^n f_{min}})^2}\]<h1 id="phase-detector">Phase Detector</h1><h2 id="harmonic-rejection-mixer"><span class="mr-2">Harmonic-Rejection Mixer</span><a href="#harmonic-rejection-mixer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://ieeexplore.ieee.org/document/972151">Original paper</a></p><p><a href="https://ieeexplore.ieee.org/document/8536535">A circuit for all seasons</a></p><p>A mixer can be used as a phase detector.</p>\[\cos(\omega t) \cdot \cos(\omega t + \phi) = \dfrac{1}{2} \cdot \cos\left( 2\omega t + \phi\right) + \dfrac{1}{2} \cdot \cos\phi\]<p>When mixing two sinosoidal signal, there is no higher harmonics.</p>\[\cos(\omega_1 t) \cdot \cos(\omega_2 t) = \dfrac{1}{2} \cdot \cos\left( (\omega_1 + \omega_2) t\right) + \dfrac{1}{2} \cdot \cos\left( (\omega_1 - \omega_2) t\right)\]<p>When mixing sinosoidal with square wave, there is higher harmonics.</p>\[f_1(t) = \cos(\omega t) - \dfrac{1}{3} \cos(3\omega t) + \dfrac{1}{5} \cos(5\omega t) - \dfrac{1}{7} \cos(7\omega t) + \dots\]<p>If we have available different phase (\(\pm 45^\circ\)) of \(f_1(t)\)</p>\[\begin{align} f_2(t) &amp;= f_1\left(t+\dfrac{T}{8}\right)\\ &amp;= \cos(\omega t + \pi/4) - \dfrac{1}{3}\cos(3\omega t + 3 \pi /4) + \dfrac{1}{5}\cos(5\omega t + 5\pi/4) + \dots\\ &amp;= \dfrac{1}{\sqrt{2}} \left( \left(\cos(\omega t)-\sin(\omega t)\right) +\dfrac{1}{3}\left(\cos(3\omega t) + \sin(3\omega t)\right) - \dfrac{1}{5}\left( \cos(5\omega t) - \sin(3\omega t) \right) \right) \end{align}\] \[\begin{align} f_3(t) &amp;= f_1\left(t-\dfrac{T}{8}\right)\\ &amp;= \cos(\omega t - \pi/4) - \dfrac{1}{3}\cos(3\omega t - 3 \pi /4) + \dfrac{1}{5}\cos(5\omega t - 5\pi/4) + \dots\\ &amp;= \dfrac{1}{\sqrt{2}} \left( \left(\cos(\omega t)+\sin(\omega t)\right) +\dfrac{1}{3}\left(\cos(3\omega t) - \sin(3\omega t)\right) - \dfrac{1}{5}\left( \cos(5\omega t) + \sin(3\omega t) \right) \right) \end{align}\]<p>thus using \(\sqrt{2}f_1(t) + f_2(t) + f_3(t)\) can cancel third and fifth harmonics.</p><h1 id="crystal-oscillator">Crystal Oscillator</h1><h2 id="resonant-frequency"><span class="mr-2">Resonant Frequency</span><a href="#resonant-frequency" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We want to calculate the resonant frequency of a crystal, including \(C_0, R_m, L_m, C_m\). By definition, resonat frequency is the frequency such that the total impedance is purely real.</p>\[Z_0 = -\dfrac{j}{\omega C_0}\] \[Z_m = R_m + j\omega L_m - \dfrac{j}{\omega C_m}\] \[Z_p = \dfrac{Z_0 Z_m}{Z_0 + Z_m} = \dfrac{\dfrac{L_m}{C_0} - \dfrac{1}{\omega^2 C_0 C_m} - \dfrac{j R_m}{\omega C_0}}{R_m + j\left(\omega L_m - \dfrac{1}{\omega C_m} - \dfrac{1}{\omega C_0}\right)}\]<p>The condition for \(Z_p\) to be purely real</p>\[\dfrac{-\dfrac{R_m}{\omega C_0}}{\dfrac{L_m}{C_0}-\dfrac{1}{\omega^2 C_0 C_m}} = \dfrac{\omega L_m - \dfrac{1}{\omega C_m} - \dfrac{1}{\omega C_0}}{R_m}\]<p>Solving the equatoin, we can find two resonant frequency</p>\[\omega_s \approx \dfrac{1}{\sqrt{L_m C_m}}\] \[\begin{align} \omega_a \approx \dfrac{1}{\sqrt{L_m \left(C_m \Vert C_0\right)}} \approx \dfrac{1}{\sqrt{L_m C_m}} \left(1+\dfrac{C_m}{2C_0}\right) \end{align}\]<p>If there are load capacitance, the load capacitance \(C_L\) will be parallel with \(C_0\), thus</p>\[\omega_s \approx \dfrac{1}{\sqrt{L_m C_m}}\] \[\omega_a \approx \dfrac{1}{\sqrt{L_m \left(C_m \Vert \left(C_0+C_L\right)\right)}} \approx \dfrac{1}{\sqrt{L_m C_m}} \left(1+\dfrac{C_m}{2(C_0+C_L)}\right)\]<p>Depending on how the oscillator is designed, the oscillation frequency will be betwenn the two value (this is stated by many books, I didn’t know the real reason for this statement though).</p>\[\omega_s \le \omega_{osc} \le \omega_a\]<h2 id="equivalent-resistance"><span class="mr-2">Equivalent Resistance</span><a href="#equivalent-resistance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s denote \(jX = j\omega L_m - \dfrac{j}{\omega C_m}\), and \(j X_{C0} = -\dfrac{j}{\omega C_0}\). The total impedence of the crystal (note that the load \(C_L\) is not included)</p>\[\begin{align} Z &amp;= \dfrac{\left(R_m + jX\right)\left(j X_{C0}\right)}{R_m + j(X+X_{C0})}\\ &amp;= \dfrac{R_m X_{C0}^2}{R_m^2 + \left(X+X_{C0}\right)^2} + \dfrac{jX_{C0}\left[R_m^2 + X\left(X+X_{C0}\right)\right]}{R_m^2 + \left(X+X_{C0}\right)^2} \end{align}\]<p>The effective resistance is given by</p>\[R_e = \dfrac{R_m X_{C0}^2}{R_m^2 + \left(X+X_{C0}\right)^2}\]<p>consider when we sweep the frequency from \(\omega_s\) to \(\omega_a\), formally \(\dfrac{1}{\sqrt{L_m C_m}} \le \omega \le \dfrac{1}{\sqrt{L_m C_m}} \left(\dfrac{C_m}{2(C_0+C_L)}\right)\). The effective resistance will increase from</p>\[R_e\vert_{\omega=\omega_s} \approx R_m\]<p>to</p>\[\begin{align} R_e\vert_{\omega=\omega_a} &amp;\approx R_m \left(\dfrac{C_L+C_0}{C_L}\right)^2 \end{align}\]</div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/analog-circuit/'>analog-circuit</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/analog/" class="post-tag no-text-decoration" >analog</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Analog+Circuits+-+Looooooong&url=%2Fposts%2Fanalog-circuits%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Analog+Circuits+-+Looooooong&u=%2Fposts%2Fanalog-circuits%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fanalog-circuits%2F&text=Analog+Circuits+-+Looooooong" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/analog-circuits/">Analog Circuits</a><li><a href="/posts/signal-and-system-01/">Signal And System 01</a><li><a href="/posts/integration-by-substitution/">Integration by Subsitution</a><li><a href="/posts/signal-and-system-explain/">Signal And System Explain</a><li><a href="/posts/engineering-mathematics/">Engineering Mathematics</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/math/">math</a> <a class="post-tag" href="/tags/analog/">analog</a> <a class="post-tag" href="/tags/pll/">pll</a> <a class="post-tag" href="/tags/fourier-analysis/">fourier-analysis</a> <a class="post-tag" href="/tags/scheme/">scheme</a> <a class="post-tag" href="/tags/sicp/">sicp</a> <a class="post-tag" href="/tags/calculus/">calculus</a> <a class="post-tag" href="/tags/cs61a/">cs61a</a> <a class="post-tag" href="/tags/em/">EM</a> <a class="post-tag" href="/tags/probability/">probability</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/online-resources/"><div class="card-body"> <em class="small" data-ts="1664470800" data-df="ll" > Sep 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Online Resources</h3><div class="text-muted small"><p> TI Precision Lab CppSim Lectures</p></div></div></a></div><div class="card"> <a href="/posts/circuit-noise/"><div class="card-body"> <em class="small" data-ts="1661532000" data-df="ll" > Aug 26, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Noise in Circuits</h3><div class="text-muted small"><p> Noise Type Thermal noise: [\overline{v_n^2}/ \Delta f = 4 k T R, \quad \overline{i_n^2} / \Delta f = \frac{4kT}{R}] MOSFET channel is (non-uniform) resistor [\overline{i_n^2}/\Delta f =...</p></div></div></a></div><div class="card"> <a href="/posts/time-transfer-constants/"><div class="card-body"> <em class="small" data-ts="1661580000" data-df="ll" > Aug 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Time and Transfer Constants in Circuits</h3><div class="text-muted small"><p> From Lectures by Prof. Ali Hajimiri. First Order System [\begin{align} H(s) = \frac{a_0 + a_1 s}{1 + b_1 s} = \frac{H^{0} + \tau H^{1}s}{1 + \tau s} \end{align}] \(\tau\) is the time constant...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/engineering-mathematics-explanation/" class="btn btn-outline-primary" prompt="Older"><p>Engineering Mathematics Explanation</p></a> <a href="/posts/analog-circuits-explanation/" class="btn btn-outline-primary" prompt="Newer"><p>Analog Circuits Explanation</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/username">Long</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/math/">math</a> <a class="post-tag" href="/tags/analog/">analog</a> <a class="post-tag" href="/tags/pll/">pll</a> <a class="post-tag" href="/tags/fourier-analysis/">fourier-analysis</a> <a class="post-tag" href="/tags/scheme/">scheme</a> <a class="post-tag" href="/tags/sicp/">sicp</a> <a class="post-tag" href="/tags/calculus/">calculus</a> <a class="post-tag" href="/tags/cs61a/">cs61a</a> <a class="post-tag" href="/tags/em/">EM</a> <a class="post-tag" href="/tags/probability/">probability</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
